<!doctype html>
<html>
    <head>
            <meta charset="utf-8" />
            <meta http-equiv="X-UA-Compatible" content="IE=edge" />
            <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
            <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>
            <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>
            <script src="store.js"></script>
                <script>
                AFRAME.registerComponent('light-distance', {
                schema: {
                    minDistance: { type: 'number', default: 10 },
                    maxDistance: { type: 'number', default: 40 },
                },

                tick: function () {
                    // カメラの位置を取得
                    const cameraPosition = this.el.sceneEl.camera.el.object3D.position;
                    // 画像の位置を取得
                    const imagePosition = this.el.object3D.position;
                    // 2点間の距離を計算
                    const distance = cameraPosition.distanceTo(imagePosition);

                    // 明るさの調整
                    let brightness = 1;
                    if (distance < this.data.minDistance) {
                        brightness = 1;
                    } else if (distance > this.data.maxDistance) {
                        brightness = 0;
                    } else {
                        const range = this.data.maxDistance - this.data.minDistance;
                        const ratio = (distance - this.data.minDistance) / range;
                        brightness = 1 - ratio;
                    }

                    // 画像のマテリアルの色を変更して明るさを調整
                    const r = 255 * brightness;
                    const g = 255 * brightness;
                    const b = 255 * brightness;
                    this.el.setAttribute('material', 'color', `rgb(${r}, ${g}, ${b})`);

                },
            });
        </script>
    </head>

    <body style="margin: 0; overflow: hidden;">
        <a-scene
            embedded
            loading-screen="enabled: false;"
            arjs="sourceType: webcam; debugUIEnabled: false;"
        >
            <a-assets>
                <script src="store.js"></script>
            </a-assets>
            <!-- Store entities will be injected by store.js -->

            <a-image
            src="assets/asset.png"
            look-at="[gps-camera]"
            scale="1 1 1"
            gps-entity-place="latitude: 24.340342554125222; longitude: 124.15838761074374;"
            ></a-image>
            <a-camera gps-camera="gpsMinDistance:2; maxDistance:100;" rotation-reader> </a-camera>
        </a-scene>
    </body>
</html>
